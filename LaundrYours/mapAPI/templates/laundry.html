<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=a86e0dbcaadb5933421ed7ee2bf5992a"></script>
    <style>
        .display-none{
            display:none
        }
    </style>
</head>
<body>
    <div id="map" style="width:500px;height:400px;"></div>
     <div id = "name" class = "display-none">
        {% for l in loc %}
            {{l.name}},
        {% endfor %}
    </div>
    <div id = "lat" class = "display-none">
        {% for l in loc %}
            {{l.lat}},
        {% endfor %}
    </div>
    <div id = "lng" class = "display-none">
        {% for l in loc %}
            {{l.lng}},
        {% endfor %}
    </div>
    <script>
        var container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
        var options = { //지도를 생성할 때 필요한 기본 옵션
            center: new kakao.maps.LatLng(37.497715, 127.027577), //지도의 중심좌표.
            level: 6 //지도의 레벨(확대, 축소 정도)
        };

        var map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴

        // getElementById(id)를 통해 해당 id를 가지는 문자열을 가져옴 ,를기준으로 쪼개서
        var list_name = document.getElementById("name").innerText.split(",")
        var list_lat = document.getElementById("lat").innerText.split(",")
        var list_lng = document.getElementById("lng").innerText.split(",")
        // 좌표 정보를 저장할 배열 생성
        var laundries = new Array();
        var mouseEvent = new Array();
        // 위도와 경도 정보를 for문을 수행하며 차례롤 좌표 배열에 저장.
        for (var idx=0; idx<list_lat.length; idx++){
            var latitude = list_lat[idx];
            var longtitude = list_lng[idx];
            laundries.push(new kakao.maps.LatLng(latitude,longtitude));
        }
    
        for (var idx=0; idx<laundries.length; idx++){
            var marker = new kakao.maps.Marker({
                map : map,
                position : laundries[idx],
                title : list_name[idx]
            });
            var content = '<div>'+list_name[idx]+'</div>';
            // 마커에 표시할 인포윈도우를 생성합니다 
            var infowindow = new kakao.maps.InfoWindow({
                content: content // 인포윈도우에 표시할 내용
            });
            // 마커에 mouseover 이벤트와 mouseout 이벤트를 등록합니다
            // 이벤트 리스너로는 클로저를 만들어 등록합니다 
            // for문에서 클로저를 만들어 주지 않으면 마지막 마커에만 이벤트가 등록됩니다
            kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
            kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
            
        }

        // 인포윈도우를 표시하는 클로저를 만드는 함수입니다 
        function makeOverListener(map, marker, infowindow) {
            return function() {
                infowindow.open(map, marker);
            };
        }

        // 인포윈도우를 닫는 클로저를 만드는 함수입니다 
        function makeOutListener(infowindow) {
            return function() {
                infowindow.close();
            };
        }

        {% comment %} marker.setMap(map); {% endcomment %}
        
        
    </script>
</body>
</html>